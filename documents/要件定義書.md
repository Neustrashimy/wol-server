# Wake-on-LAN Web起動ツール（Raspberry Pi用）

## 概要

本システムは、Raspberry Pi上に常駐させることで、LAN内のPCに対してWake-on-LAN（WoL）による電源投入をWebブラウザから行えるツールです。Web UIを備えており、登録端末の一覧管理・起動・登録・削除、疎通確認などの操作を行えます。

## 目的

- ブラウザベースでLAN内PCを簡単に起動
- Raspberry Pi 3B をホストとして常時稼働
- OSSとして公開可能な拡張性とシンプルな構成
- 初期はローカル利用専用とし、将来的に認証・ログ対応を検討

---

## 実行環境

| 項目         | 内容                     |
|--------------|--------------------------|
| ハードウェア | Raspberry Pi 3B          |
| OS           | Raspberry Pi OS          |
| 言語         | Python 3                 |
| Webサーバ    | Nginx（リバースプロキシ）|
| バックエンド | Flask                    |
| データ保存   | SQLite（標準モジュール） |
| 多言語対応   | Flask-Babel（初期は日本語のみ）|

---

## 機能要件

### フェーズ1（プロトタイプ）

- 登録済み端末の一覧表示（名前・MACアドレス・備考、並び替え対応）
- WoL送信（起動ボタンからMACアドレスへマジックパケット送信）
- 端末の登録（名前・MACアドレス・備考の入力、IPアドレスは任意）
- 端末の削除（UI上の操作で削除）
- SQLiteでの永続保存・操作
- IPアドレスが登録されている端末に対して `ping` による疎通確認
- Flask-Babelによる多言語対応（初期は日本語のみ）

### フェーズ2（将来的な拡張）

- 起動要求ログ記録（時刻・IP・成否など）
- 認証機能（単一ユーザーによるフォーム認証）
- パスワード変更画面（ログイン後に変更可能）
- REST APIの提供（外部連携を可能に）
- 英語等の言語追加、テーマ切り替え（任意）

---

## オンライン状態の検出機能（IPベース）

### 概要

端末に登録されているIPアドレスを用いて `ping` を実行し、応答の有無によってオンライン／オフラインを判定します。

### 判定基準

| 状態      | 条件                                   |
|-----------|----------------------------------------|
| オンライン | `ping` 成功（応答あり）               |
| オフライン | `ping` 失敗（応答なし）               |
| 不明       | IPアドレス未登録または無効な形式      |

### 注意点

- DHCPでIPアドレスが変動する環境では、正確な疎通確認のために固定IPまたはDHCPリース予約を推奨します。
- `ping` 応答をファイアウォールでブロックしている端末では、正しく判定できない場合があります。

---

## 非機能要件

- システムは常時常駐型として稼働（`systemd`対応）
- データベースは初期化時に全テーブル作成（マイグレーション非対応）
- 外部公開は想定せずHTTPS等は現時点で不要
- OSS公開に向けた構成・ドキュメント整備を想定

---

## データベース定義（SQLite）

### devices（端末一覧）

| カラム名      | 型       | 説明                     |
|---------------|----------|--------------------------|
| id            | INTEGER  | 主キー                   |
| name          | TEXT     | 端末名                   |
| mac_address   | TEXT     | MACアドレス              |
| ip_address    | TEXT     | IPアドレス（任意）       |
| note          | TEXT     | 備考                     |
| created_at    | TEXT     | 登録日時（ISO形式）     |

### logs（起動ログ）

| カラム名      | 型       | 説明                          |
|---------------|----------|-------------------------------|
| id            | INTEGER  | 主キー                        |
| device_id     | INTEGER  | 外部キー（`devices.id`）      |
| timestamp     | TEXT     | 実行日時（ISO形式）          |
| client_ip     | TEXT     | 要求元IPアドレス              |
| result        | TEXT     | 実行結果（`success`, `fail`）|
| message       | TEXT     | 補足・エラーメッセージ        |

---

## ローカル認証（将来実装）

- 多ユーザー非対応、単一パスワード認証
- パスワードはハッシュ化して `auth/password.txt` に保存
- ハッシュ方式は `bcrypt` または `pbkdf2_hmac` を予定
- 初期化用スクリプト（`auth/setup.py`）でパスワード生成

---

## 多言語対応（i18n）

- `Flask-Babel` により国際化対応
- 初期対応言語は日本語（`ja`）
- 翻訳ファイルは `.po` / `.mo` 形式で管理（`translations/`）
- UI文言にはJinja2内で `_('文字列')` を使用

---

## ディレクトリ構成（予定）

wol-server/
├── app.py # Flaskエントリポイント
├── config.py # 設定ファイル
├── db/
│ └── database.py # SQLite DB操作モジュール
├── wake/
│ └── wol.py # WoL送信処理
├── auth/
│ ├── auth.py # パスワード検証
│ ├── setup.py # 初期ハッシュ生成
│ └── password.txt # 保存済みハッシュ
├── static/ # CSS, JS
├── templates/ # HTMLテンプレート（Jinja2）
├── translations/ # i18nリソース（ja, enなど）
└── requirements.txt # Python依存ライブラリ


---

## ライセンス（予定）

- オープンソースライセンス：MIT または Apache 2.0 を想定

---

## 今後のステップ

1. 画面構成・ルーティング設計
2. 初期テーブル・ディレクトリのセットアップ
3. Flaskアプリの最小構成でプロトタイピング開始
4. IPベースのオンライン検出機能を組み込み
